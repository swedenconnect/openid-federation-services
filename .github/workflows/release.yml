name: Automated publication of docker image
on:
  push:
    tags:
      - 'v*'
jobs:
  prepare:
    uses: swedenconnect/openid-federation-commons/.github/workflows/mvn-artifact-version-prepare.yml@workflow
    secrets: inherit
  release:
    uses: swedenconnect/openid-federation-commons/.github/workflows/docker-ghcr-publish.yml@workflow
    secrets: inherit
    with:
      service-path: oidf-services
    needs: prepare
  finalize-release:
    uses: swedenconnect/openid-federation-commons/.github/workflows/finalize.yml@workflow
    secrets: inherit
    with:
      auto-update-revision: true
    needs: release